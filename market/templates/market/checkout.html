{% extends "market/base.html" %}
{% load widget_tweaks %}

{% block title %}Checkout - GameMarket{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-6 border-b pb-4">Finalização da Compra</h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Coluna da Esquerda: Detalhes do Pedido -->
        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-xl space-y-4 border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-3">Resumo do Pedido</h2>
            
            {% for product in products %}
            <div class="flex justify-between items-center text-sm text-gray-700">
                <span class="truncate pr-2">{{ product.nome }}</span>
                <span class="font-semibold text-primary">R$ {{ product.preco|floatformat:2 }}</span>
            </div>
            {% endfor %}

            <div class="border-t pt-4 mt-4 flex justify-between items-center text-2xl font-extrabold text-gray-900">
                <span>TOTAL:</span>
                <span class="text-secondary">R$ {{ total|floatformat:2 }}</span>
            </div>
            
            <p class="text-sm text-gray-500 pt-2 border-t">A compra será processada em uma única transação, descontando o estoque de cada item.</p>
        </div>
        
        <!-- Coluna da Direita: Formulário de Entrega -->
        <div class="lg:col-span-2 bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Informações de Entrega</h2>
            
            <form method="post" class="space-y-6">
                {% csrf_token %}

                <!-- Campos de Informação Pessoal -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {% for field in form %}
                        {% if field.name == 'nome_completo' or field.name == 'email' %}
                            <div>
                                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
                                {{ field }}
                                {% for error in field.errors %}<p class="mt-1 text-sm text-red-600">{{ error }}</p>{% endfor %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- Campos de Endereço -->
                <div>
                    <label for="{{ form.endereco.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.endereco.label }}</label>
                    {{ form.endereco }}
                    {% for error in form.endereco.errors %}<p class="mt-1 text-sm text-red-600">{{ error }}</p>{% endfor %}
                </div>

                <!-- Campos Cidade, Estado, CEP -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="{{ form.cidade.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.cidade.label }}</label>
                        {{ form.cidade }}
                        {% for error in form.cidade.errors %}<p class="mt-1 text-sm text-red-600">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label for="{{ form.estado.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.estado.label }}</label>
                        {{ form.estado }}
                        {% for error in form.estado.errors %}<p class="mt-1 text-sm text-red-600">{{ error }}</p{% endfor %}
                    </div>
                    <div>
                        <label for="{{ form.cep.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.cep.label }}</label>
                        {{ form.cep }}
                        {% for error in form.cep.errors %}<p class="mt-1 text-sm text-red-600">{{ error }}</p>{% endfor %}
                    </div>
                </div>

                {% if form.non_field_errors %}
                    <div class="p-3 bg-red-100 text-red-700 rounded-lg">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                
                <button type="submit" 
                        class="w-full bg-primary hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-lg text-xl">
                    Confirmar e Pagar (Simulação)
                </button>
            </form>
        </div>
        
    </div>
</div>
{% endblock %}