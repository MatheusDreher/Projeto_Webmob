{% extends "market/base.html" %}

{% block title %}{{ product.nome }} - GameMarket{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

    <!-- Botão Voltar -->
    <a href="{% url 'market:product_list' %}" 
       class="flex items-center text-primary hover:text-teal-700 mb-6 font-semibold text-sm sm:text-base">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Voltar ao Catálogo
    </a>

    <!-- Container Principal -->
    <div class="bg-white rounded-3xl shadow-xl p-6 lg:p-10 border border-gray-100 
                grid grid-cols-1 lg:grid-cols-2 gap-10">

        <!-- COLUNA ESQUERDA (Imagem + Título no Mobile) -->
        <div>

            <!-- Nome do Produto no MOBILE -->
            <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-1 block lg:hidden">
                {{ product.nome }}
            </h1>

            <p class="text-gray-500 text-base sm:text-lg mb-4 block lg:hidden">
                {{ product.get_plataforma_display }}
            </p>

            <!-- Imagem principal -->
            <div class="bg-gray-100 rounded-2xl overflow-hidden shadow-lg">
                {% if product.imagem %}
                    <img src="{{ product.imagem.url }}" alt="{{ product.nome }}"
                         class="w-full h-64 sm:h-80 md:h-[420px] object-cover transition duration-300 hover:scale-105">
                {% else %}
                    <div class="w-full h-64 sm:h-80 md:h-[420px] bg-gray-800 
                                flex items-center justify-center text-white text-lg sm:text-xl font-bold">
                        Imagem Não Disponível
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- COLUNA DIREITA (Detalhes) -->
        <div>

            <!-- Nome e Plataforma no DESKTOP -->
            <h1 class="hidden lg:block text-3xl xl:text-4xl font-extrabold text-gray-900 mb-2">
                {{ product.nome }}
            </h1>

            <p class="hidden lg:block text-gray-500 text-lg mb-4">
                {{ product.get_plataforma_display }}
            </p>

            <!-- Categoria -->
            <span class="text-xs sm:text-sm font-semibold uppercase tracking-wider px-3 py-1 rounded-full mb-5 inline-block
                {% if product.categoria == 'CONSOLE' %}text-red-700 bg-red-100
                {% elif product.categoria == 'JOGO' %}text-blue-700 bg-blue-100
                {% else %}text-green-700 bg-green-100{% endif %}">
                {{ product.get_categoria_display }}
            </span>

            <!-- PREÇO + ESTOQUE + AÇÃO DE COMPRA -->
            <div class="bg-gray-50 rounded-xl border border-gray-200 p-5 sm:p-6 shadow-inner mb-8">

                <p class="text-gray-500 text-xs sm:text-sm font-medium uppercase">
                    Preço Exclusivo
                </p>

                <div class="flex items-center justify-between mt-1 flex-wrap gap-2">
                    <span class="text-3xl sm:text-4xl font-extrabold text-primary">
                        R$ {{ product.preco|floatformat:2 }}
                    </span>

                    {% if product.estoque > 0 %}
                        <span class="text-green-600 font-bold text-lg">
                            Em Estoque ({{ product.estoque }})
                        </span>
                    {% else %}
                        <span class="text-red-600 font-bold text-lg">Esgotado</span>
                    {% endif %}
                </div>

                <!-- Botão de compra -->
                {% if product.estoque > 0 and not is_in_cart %}
                    <a href="{% url 'market:add_to_cart' pk=product.pk %}"
                       class="w-full mt-4 py-3 px-4 rounded-lg font-bold text-lg block text-center
                              bg-secondary hover:bg-orange-600 text-white shadow-lg transition">
                        Adicionar ao Carrinho
                    </a>
                {% elif is_in_cart %}
                    <a href="{% url 'market:cart_detail' %}"
                       class="w-full mt-4 py-3 px-4 rounded-lg font-bold text-lg block text-center
                              bg-yellow-500 hover:bg-yellow-600 text-white shadow-lg transition">
                        Já no Carrinho — Ir para o Carrinho
                    </a>
                {% else %}
                    <button disabled
                            class="w-full mt-4 py-3 px-4 rounded-lg font-bold text-lg 
                                   bg-gray-300 text-gray-600 cursor-not-allowed text-center">
                        Produto Esgotado
                    </button>
                {% endif %}
            </div>

            <!-- DESCRIÇÃO DO PRODUTO -->
            <div class="border-t pt-6">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 border-b pb-2">
                    Descrição Completa
                </h2>

                <div class="prose max-w-none text-gray-700 text-sm sm:text-base leading-relaxed">
                    {{ product.descricao|linebreaksbr }}
                </div>
            </div>

            <!-- ESPECIFICAÇÕES -->
            <div class="border-t pt-6 mt-8">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 border-b pb-2">
                    Especificações Técnicas
                </h2>

                <dl class="space-y-4 divide-y divide-gray-200">

                    <div class="flex justify-between py-2">
                        <dt class="text-gray-600 font-medium">Plataforma</dt>
                        <dd class="text-gray-900 font-semibold">{{ product.get_plataforma_display }}</dd>
                    </div>

                    <div class="flex justify-between py-2">
                        <dt class="text-gray-600 font-medium">Categoria</dt>
                        <dd class="text-gray-900 font-semibold">{{ product.get_categoria_display }}</dd>
                    </div>

                    <div class="flex justify-between py-2">
                        <dt class="text-gray-600 font-medium">Estoque</dt>
                        <dd class="font-semibold {% if product.estoque > 0 %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if product.estoque > 0 %}{{ product.estoque }} unidades{% else %}Esgotado{% endif %}
                        </dd>
                    </div>

                    <div class="flex justify-between py-2">
                        <dt class="text-gray-600 font-medium">SKU</dt>
                        <dd class="text-gray-900 font-semibold">GM-{{ product.pk|stringformat:"06d" }}</dd>
                    </div>

                    <div class="flex justify-between py-2">
                        <dt class="text-gray-600 font-medium">Cadastrado em</dt>
                        <dd class="text-gray-900 font-semibold">{{ product.data_cadastro|date:"d/m/Y H:i" }}</dd>
                    </div>

                    <!-- Campos específicos -->
                    {% if product.categoria == 'JOGO' %}
                        {% if product.genero %}
                        <div class="flex justify-between py-2">
                            <dt class="text-gray-600 font-medium">Gênero</dt>
                            <dd class="text-gray-900 font-semibold">{{ product.genero }}</dd>
                        </div>
                        {% endif %}
                        {% if product.classificacao_etaria %}
                        <div class="flex justify-between py-2">
                            <dt class="text-gray-600 font-medium">Classificação</dt>
                            <dd class="text-red-600 font-semibold">{{ product.get_classificacao_etaria_display }}</dd>
                        </div>
                        {% endif %}

                    {% elif product.categoria == 'CONSOLE' %}
                        {% if product.cpu_gpu %}
                        <div class="flex justify-between py-2">
                            <dt class="text-gray-600 font-medium">CPU/GPU</dt>
                            <dd class="text-gray-900 font-semibold">{{ product.cpu_gpu }}</dd>
                        </div>
                        {% endif %}
                        {% if product.memoria_ram %}
                        <div class="flex justify-between py-2">
                            <dt class="text-gray-600 font-medium">RAM</dt>
                            <dd class="text-gray-900 font-semibold">{{ product.memoria_ram }}</dd>
                        </div>
                        {% endif %}

                    {% elif product.categoria == 'ACESSORIO' %}
                        {% if product.compatibilidade %}
                        <div class="flex justify-between py-2">
                            <dt class="text-gray-600 font-medium">Compatibilidade</dt>
                            <dd class="text-gray-900 font-semibold">{{ product.compatibilidade }}</dd>
                        </div>
                        {% endif %}
                    {% endif %}

                </dl>
            </div>

        </div>
    </div>
</div>
{% endblock %}
